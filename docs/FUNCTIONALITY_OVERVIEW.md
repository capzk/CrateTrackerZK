# CrateTrackerZK 插件功能概述

> 📖 **快速了解**：本文档提供插件的快速功能概览。如需详细了解功能和运行逻辑，请参阅 [功能与运行逻辑完整文档](FUNCTIONALITY_AND_LOGIC.md)。

## 插件简介

CrateTrackerZK 是一个魔兽世界插件，用于自动追踪和记录游戏中的战争物资空投宝箱（War Supply Crate）的刷新时间和位面信息。

**版本**: 1.1.2  
**作者**: capzk  
**项目地址**: https://github.com/capzk/CrateTrackerZK

## 核心功能

### 1. 自动空投检测
- 通过地图图标（Vignette）系统自动检测空投箱子的出现
- 检测到空投后自动记录刷新时间
- 支持持续检测确认机制（2秒确认期）

### 2. 刷新时间追踪
- 自动计算下次刷新时间（默认间隔1100秒）
- 实时显示倒计时
- 支持手动输入刷新时间
- 数据持久化保存（SavedVariables）

### 3. 位面（Phase）追踪
- 自动检测当前位面ID
- 通过鼠标指向NPC获取位面信息
- 显示位面变化提示
- 位面ID颜色标识（绿色=当前位面，红色=不同位面）

### 4. 多地图支持
当前支持追踪的地图：
- 多恩岛 (MapID: 2248)
- 海妖岛 (MapID: 2369)
- 卡雷什 (MapID: 2371)
- 安德麦 (MapID: 2346)
- 陨圣峪 (MapID: 2215)
- 喧鸣深窟 (MapID: 2214)
- 艾基-卡赫特 (MapID: 2255)

### 5. 用户界面
- 主面板：显示所有地图的刷新状态
- 浮动按钮：快速打开/关闭主面板
- 可拖拽界面
- 实时更新（每秒刷新）

### 6. 团队通知
- **自动检测通知**：受 `/ctk team on/off` 控制
  - 在团队中：发送 RAID + RAID_WARNING 两条消息
  - 在小队中：不发送自动消息
- **手动通知**：不受命令控制，始终根据队伍状态发送
  - 在队伍中：发送到队伍（PARTY/RAID/INSTANCE_CHAT）
  - 不在队伍中：发送到聊天框

### 7. 多语言支持
- 支持语言：简体中文 (zhCN)、繁体中文 (zhTW)、英文 (enUS)、俄文 (ruRU)
- 自动根据客户端语言切换
- 英文作为回退语言

## 用户命令

- `/ctk` 或 `/ct` - 打开/关闭主面板
- `/ctk help` - 显示帮助信息
- `/ctk clear` - 清除所有数据并重新初始化
- `/ctk team on/off` - 开启/关闭团队通知
- `/ctk debug on/off` - 开启/关闭调试模式

## 数据存储

插件使用两个 SavedVariables：
- `CRATETRACKERZK_DB` - 存储地图数据（刷新时间、位面信息等）
- `CRATETRACKERZK_UI_DB` - 存储UI设置（窗口位置、按钮位置、通知设置等）

## 技术特性

- 区域有效性检测（自动暂停在副本/战场/室内）
- 智能地图匹配（支持父地图匹配）
- 防误触机制（持续检测确认）
- 调试模式支持
- 模块化架构设计

